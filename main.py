import streamlit as st             # å¯¼å…¥streamlitåº“å¹¶ç»™å®ƒä¸€ä¸ªç®€çŸ­çš„åˆ«åstã€‚å¯ä»¥ä½¿ç”¨stæ¥è®¿é—®streamlitåº“çš„æ‰€æœ‰åŠŸèƒ½
from utils import generate_script  # ä»æ–‡ä»¶ langchain_ç»„ä»¶ å¯¼å…¥ generate_script å‡½æ•°
from model import Model            # ä»æ–‡ä»¶ model_ç»„ä»¶ å¯¼å…¥ Model ç±»

# ä¾§è¾¹æ  å¸ƒå±€
with st.sidebar:  # ä¾§è¾¹æ  å¸ƒå±€
    æ¨¡å‹åˆ—è¡¨ = ["gemini-2.0-flash","deepseek-V3","kimi_moonshot"]
    å•é€‰æ¨¡å‹ = st.selectbox("æ¨¡å‹é€‰æ‹©:", æ¨¡å‹åˆ—è¡¨, index=1)
    f"ä½ é€‰æ‹©çš„æ¨¡å‹ä¸ºï¼š{å•é€‰æ¨¡å‹}"  # æ˜¾ç¤º å­—ç¬¦ä¸²
    st.markdown("---")

    if å•é€‰æ¨¡å‹:
        if å•é€‰æ¨¡å‹ == "gemini-2.0-flash":
            st_api_key = st.text_input("è¯·è¾“å…¥APIå¯†é’¥:", type="password")  # å¯†ç  è¾“å…¥æ¡† # è¿”å› æ–‡å­—
            st.markdown("[APIè·å–åœ°å€](https://ai.google.dev/gemini-api/docs?hl=zh-cn)")
        elif å•é€‰æ¨¡å‹ == "deepseek-V3":
            st_api_key = st.text_input("è¯·è¾“å…¥APIå¯†é’¥:", type="password")  # å¯†ç  è¾“å…¥æ¡† # è¿”å› æ–‡å­—
            st.markdown("[APIè·å–åœ°å€](https://api-docs.deepseek.com/zh-cn/)")
        elif å•é€‰æ¨¡å‹ == "kimi_moonshot":
            st_api_key = st.text_input("è¯·è¾“å…¥APIå¯†é’¥:", type="password")  # å¯†ç  è¾“å…¥æ¡† # è¿”å› æ–‡å­—
            st.markdown("[APIè·å–åœ°å€](https://platform.moonshot.cn/console/account)")

# æ˜¾ç¤º å¤§æ ‡é¢˜
st.title("ğŸ¬çŸ­è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨")  # æ˜¾ç¤º å¤§æ ‡é¢˜

# è¡Œæ–‡å­— è¾“å…¥æ¡†
st_è§†é¢‘ä¸»é¢˜ = st.text_input("ğŸ’¡è¯·è¾“å…¥è§†é¢‘ä¸»é¢˜")  # è¡Œæ–‡å­— è¾“å…¥æ¡†  # è¿”å› æ–‡å­—

# æ•°å­— è¾“å…¥æ¡†
st_è§†é¢‘æ—¶é•¿ = st.number_input("âŒšè¯·è¾“å…¥è§†é¢‘æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰",value=1.0,min_value=0.1,step=0.1)  # æ•°å­— è¾“å…¥æ¡†  # è¿”å› è¾“å…¥æ•°å­—

# æ•°å­— è¾“å…¥æ¡†
st_åˆ›é€ åŠ› = st.number_input("âœ¨è¯·è¾“å…¥åˆ›æ„å€¼ï¼ˆ0-2ï¼‰",value=1.0,min_value=0.0,max_value=2.0,step=0.1)  # æ•°å­— è¾“å…¥æ¡† # è¿”å› è¾“å…¥æ•°å­—

# æŒ‰é’® äº¤äº’
st_æäº¤æŒ‰é’® = st.button("ç”Ÿæˆè„šæœ¬")  # æŒ‰é’® äº¤äº’ # è¿”å› å¸ƒå°”å€¼ï¼ˆç‚¹å‡»Trueï¼Œä¸æŒ‰False)

# +------------------------------------------------------------------+
# |                             æäº¤å‰ æ£€æŸ¥                            |
# +------------------------------------------------------------------+
# æ£€æµ‹api_keyæ˜¯å¦è¾“å…¥:
if st_æäº¤æŒ‰é’® and not st_api_key:  # å¦‚æœ ç‚¹å‡»æŒ‰é’® å¹¶æ²¡æœ‰ è¾“å…¥ AIPå¯†é’¥
    st.info("è¯·è¾“å…¥APIå¯†é’¥")  # æé†’ æç¤º
    st.stop()               # ç»ˆæ­¢ # ç±»ä¼¼break

# æ£€æµ‹è§†é¢‘ä¸»é¢˜æ˜¯å¦è¾“å…¥:
if st_æäº¤æŒ‰é’® and not st_è§†é¢‘ä¸»é¢˜: # å¦‚æœ ç‚¹å‡»æŒ‰é’® å¹¶æ²¡æœ‰ è¾“å…¥ ä¸»é¢˜
    st.info("è¯·è¾“å…¥è§†é¢‘ä¸»é¢˜")       # æé†’ æç¤º
    st.stop()                    # ç»ˆæ­¢ # ç±»ä¼¼break

# +------------------------------------------------------------------+
# |                             æäº¤                                  |
# +------------------------------------------------------------------+
# æäº¤ è°ƒç”¨è‡ªå®šä¹‰å‡½æ•°
if st_æäº¤æŒ‰é’®:
    # åŠ è½½ç­‰å¾…æç¤º
    with st.spinner("AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç­‰å¾…..."):  # ä½¿ç”¨ st.spinner åˆ›å»ºä¸€ä¸ªåŠ è½½åŠ¨ç”»ï¼Œæç¤ºç”¨æˆ· AI æ­£åœ¨æ€è€ƒ # åªè¦ä»¥ä¸‹ä»£ç æ²¡æœ‰è¿è¡Œå®Œï¼Œå°±ä¼šä¸€ç›´æç¤ºæ­£åœ¨åŠ è½½
        # æ ¹æ®é€‰ä¸­çš„æ¨¡å‹ï¼Œåˆ›å»º Model å®ä¾‹ï¼Œå¹¶ä¼ å…¥ temperature
        if å•é€‰æ¨¡å‹ == "gemini-2.0-flash":
            st_æ¨¡å‹ = Model(temperature=st_åˆ›é€ åŠ›,api_key=st_api_key).gemini_2_flash
        elif å•é€‰æ¨¡å‹ == "deepseek-V3":
            st_æ¨¡å‹ = Model(temperature=st_åˆ›é€ åŠ›,api_key=st_api_key).deepseek_v3
        elif å•é€‰æ¨¡å‹ == "kimi_moonshot":
            st_æ¨¡å‹ = Model(temperature=st_åˆ›é€ åŠ›,api_key=st_api_key).kimi_moonshot_v1_8k
        # æäº¤
        ç»´åŸºæœç´¢_ç»“æœ, è§†é¢‘ä¸»é¢˜, è§†é¢‘è„šæœ¬ = generate_script(st_è§†é¢‘ä¸»é¢˜,st_è§†é¢‘æ—¶é•¿,é€‰æ‹©æ¨¡å‹=st_æ¨¡å‹)  # è°ƒç”¨å‡½æ•° è¿”å› ç»“æœ

    # æˆåŠŸ æç¤º
    st.success("è§†é¢‘è„šæœ¬ç”ŸæˆæˆåŠŸ")   # æˆåŠŸ æç¤º
    st.divider()  # æ˜¾ç¤º åˆ†å‰²çº¿

    # +---------------------------------------------------+
    # |                    æ˜¾ç¤ºç”Ÿæˆå†…å®¹                      |
    # +---------------------------------------------------+
    # æ˜¾ç¤º ä¸»é¢˜
    st.subheader("ğŸ–è§†é¢‘ä¸»é¢˜") # æ˜¾ç¤º å‰¯æ ‡é¢˜
    st.write(è§†é¢‘ä¸»é¢˜)
    st.divider()  # æ˜¾ç¤º åˆ†å‰²çº¿

    # æ˜¾ç¤º è„šæœ¬
    st.subheader("ğŸ“„è§†é¢‘è„šæœ¬")  # æ˜¾ç¤º å‰¯æ ‡é¢˜
    st.write(è§†é¢‘è„šæœ¬)
    st.divider()  # æ˜¾ç¤º åˆ†å‰²çº¿

    # æŠ˜å å±•å¼€ ç»´åŸºç™¾ç§‘
    with st.expander("ğŸ”ç»´åŸºç™¾ç§‘æœç´¢ç»“æœ"):
        st.info(ç»´åŸºæœç´¢_ç»“æœ)  # æé†’ æç¤º

# streamlit run main.py